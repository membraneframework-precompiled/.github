# Membrane Framework Precompiled

This organization serves a purpose of hosting precompiled builds of packages and libraries required by [Membrane](https://github.com/membraneframework) plugins. These builds are generated by installing packages with [homebrew](https://brew.sh/) on different CircleCI execution environments.

## Adding New Precompiled Builds

If you want to add a new package repository using the automated method (homebrew on CircleCI), follow these steps:

1. Ensure the package is available in homebrew by running `brew info <package>` or check at `https://formulae.brew.sh/formula/<package>`

2. Create a repository named `precompiled_<package>` (for instance, `precompiled_portaudio`) from the `precompiled_template` template.

3. In the `.circleci/config.yml` file, replace `PACKAGE_NAME_HERE` with the package name (the same one that was used in the repository name).

4. On [CircleCI Project Dashboard](https://app.circleci.com/projects/project-dashboard/github/membraneframework-precompiled/) set up a new project of the package's repository.
   
5. In the newly created project navigate to **Project Settings** > **Environment Variables** > **Import Variables** and import the `GITHUB_TOKEN` variable from any other precompiled package's repository.

To initiate the precompilation process, push a tag matching the latest version of your package, prefixed with 'v'. You can check the latest version of the package by running `brew info <package>` or visiting `https://formulae.brew.sh/formula/<package>`. For example, to trigger the precompilation of a package with a latest version of 1.2.3, you would need to push a `v1.2.3` tag. 
Once the CircleCI pipeline finishes the precompilation and publishing process, a new release will be created from the pushed tag that contains the precompiled builds of the package. By default there will be three archives:
- `<package>_linux.tar.gz`
- `<package>_macos_arm.tar.gz`
- `<package>_macos_intel.tar.gz`

Each of them will contain the package built for specified OS and architecture. Repos and releases structured this way can be further utilized by [Bundlex](https://github.com/membraneframework/bundlex) and [Membrane Precompiled Dependency Provider](https://github.com/membraneframework/membrane_precompiled_dependency_provider)
